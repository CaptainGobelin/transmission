[gd_scene load_steps=19 format=1]

[ext_resource path="res://assets/inventory.png" type="Texture" id=1]
[ext_resource path="res://scenes/Item.tscn" type="PackedScene" id=2]
[ext_resource path="res://assets/nuage.png" type="Texture" id=3]
[ext_resource path="res://assets/dialogue.png" type="Texture" id=4]

[sub_resource type="GDScript" id=1]

script/source = "extends Control

var is_mouse_on_gui = false

func _on_Area2D_mouse_enter():
	is_mouse_on_gui = true

func _on_Area2D_mouse_exit():
	is_mouse_on_gui = false

func _on_Area2DDialogue_mouse_exit():
	is_mouse_on_gui = false

func _on_Area2DDialogue_mouse_enter():
	is_mouse_on_gui = true
"

[sub_resource type="GDScript" id=2]

script/source = "extends Control

onready var open_button = get_node(\"Sprite/Area2D/CollisionPolygon2D\")
onready var animation_player = get_node(\"AnimationPlayer\")
var is_closed = true

func _on_Area2D_input_event( viewport, event, shape_idx ):
	if (event.type==InputEvent.MOUSE_BUTTON and event.pressed and event.button_index==BUTTON_LEFT):
		if (not animation_player.is_playing()):
			if (is_closed):
				animation_player.play(\"open\")
				is_closed = false
			else:
				animation_player.play(\"close\")
				is_closed = true
"

[sub_resource type="ConvexPolygonShape2D" id=3]

custom_solver_bias = 0.0
points = Vector2Array( 18.9556, 463.118, 21.745, 703.015, -159.573, 700.226, -148.415, 89.3233 )

[sub_resource type="ConvexPolygonShape2D" id=4]

custom_solver_bias = 0.0
points = Vector2Array( 66.3772, 379.432, 18.9556, 463.118, -148.415, 89.3233, 18.9556, 309.695 )

[sub_resource type="ConvexPolygonShape2D" id=5]

custom_solver_bias = 0.0
points = Vector2Array( 18.9556, 309.695, -148.415, 89.3233, 16.166, 89.3233 )

[sub_resource type="ConvexPolygonShape2D" id=6]

custom_solver_bias = 0.0
points = Vector2Array( -7.42282, -71.6443, 34.6825, -14.0266, -12.963, 51.3474, -24.0433, 52.4554, -24.0433, -73.8604 )

[sub_resource type="Animation" id=7]

length = 0.3
loop = false
step = 0.05
tracks/0/type = "value"
tracks/0/path = NodePath(".:rect/pos")
tracks/0/interp = 1
tracks/0/imported = false
tracks/0/keys = {
"times": FloatArray( 0, 0.15, 0.25, 0.3 ),
"transitions": FloatArray( 1, 1, 1, 1 ),
"update": 0,
"values": [ Vector2( 140, 400 ), Vector2( 60, 400 ), Vector2( 25, 400 ), Vector2( 20, 400 ) ]
}

[sub_resource type="Animation" id=8]

length = 0.3
loop = false
step = 0.05
tracks/0/type = "value"
tracks/0/path = NodePath(".:rect/pos")
tracks/0/interp = 1
tracks/0/imported = false
tracks/0/keys = {
"times": FloatArray( 0, 0.15, 0.25, 0.3 ),
"transitions": FloatArray( 1, 1, 1, 1 ),
"update": 0,
"values": [ Vector2( 20, 400 ), Vector2( 100, 400 ), Vector2( 135, 400 ), Vector2( 140, 400 ) ]
}

[sub_resource type="GDScript" id=9]

script/source = "export(String) var item_name

var is_possessed = false

func possess():
	is_possessed = true
	for point in get_node(\"../../ItemPlaces\").get_children():
		if (not point.used):
			set_pos(point.get_pos())
			point.used = true
			show()
			return"

[sub_resource type="GDScript" id=10]

script/source = "var used = false"

[sub_resource type="GDScript" id=14]

script/source = "extends Control

var is_closed = true

"

[sub_resource type="ConvexPolygonShape2D" id=13]

custom_solver_bias = 0.0
points = Vector2Array( 1609.72, 755.729, 1602.87, 1087.93, 352.826, 1084.51, 349.401, 755.729 )

[sub_resource type="Animation" id=11]

resource/name = "close"
length = 0.4
loop = false
step = 0.1
tracks/0/type = "value"
tracks/0/path = NodePath("Sprite:transform/pos")
tracks/0/interp = 1
tracks/0/imported = false
tracks/0/keys = {
"times": FloatArray( 0, 0.4 ),
"transitions": FloatArray( 1, 1 ),
"update": 0,
"values": [ Vector2( 975, 900 ), Vector2( 975, 1230 ) ]
}
tracks/1/type = "value"
tracks/1/path = NodePath("Area2DDialogue:transform/pos")
tracks/1/interp = 1
tracks/1/imported = false
tracks/1/keys = {
"times": FloatArray( 0, 0.4 ),
"transitions": FloatArray( 1, 1 ),
"update": 0,
"values": [ Vector2( 0, 0 ), Vector2( 0, 330 ) ]
}

[sub_resource type="Animation" id=12]

resource/name = "open"
length = 0.8
loop = true
step = 0.1
tracks/0/type = "value"
tracks/0/path = NodePath("Sprite:transform/pos")
tracks/0/interp = 1
tracks/0/imported = false
tracks/0/keys = {
"times": FloatArray( 0, 0.4, 0.7, 0.8 ),
"transitions": FloatArray( 1, 1, 1, 1 ),
"update": 0,
"values": [ Vector2( 975, 1230 ), Vector2( 975, 1000 ), Vector2( 975, 930 ), Vector2( 975, 900 ) ]
}
tracks/1/type = "value"
tracks/1/path = NodePath("Area2DDialogue:transform/pos")
tracks/1/interp = 1
tracks/1/imported = false
tracks/1/keys = {
"times": FloatArray( 0, 0.4, 0.7, 0.8 ),
"transitions": FloatArray( 1, 1, 1, 1 ),
"update": 0,
"values": [ Vector2( 0, 330 ), Vector2( 0, 100 ), Vector2( 0, 30 ), Vector2( 0, 0 ) ]
}

[node name="GUI" type="Control"]

focus/ignore_mouse = false
focus/stop_mouse = true
size_flags/horizontal = 2
size_flags/vertical = 2
margin/left = 0.0
margin/top = 0.0
margin/right = 40.0
margin/bottom = 40.0
script/script = SubResource( 1 )

[node name="Inventory" type="Control" parent="."]

editor/display_folded = true
focus/ignore_mouse = false
focus/stop_mouse = true
size_flags/horizontal = 2
size_flags/vertical = 2
margin/left = 20.0
margin/top = 400.0
margin/right = 60.0
margin/bottom = 440.0
script/script = SubResource( 2 )

[node name="Area2D" type="Area2D" parent="Inventory"]

editor/display_folded = true
transform/pos = Vector2( -20, -400 )
input/pickable = true
shapes/0/shape = SubResource( 3 )
shapes/0/transform = Matrix32( 1, 0, 0, 1, 0, 0 )
shapes/0/trigger = false
shapes/1/shape = SubResource( 4 )
shapes/1/transform = Matrix32( 1, 0, 0, 1, 0, 0 )
shapes/1/trigger = false
shapes/2/shape = SubResource( 5 )
shapes/2/transform = Matrix32( 1, 0, 0, 1, 0, 0 )
shapes/2/trigger = false
gravity_vec = Vector2( 0, 1 )
gravity = 98.0
linear_damp = 0.1
angular_damp = 1.0

[node name="CollisionPolygon2D" type="CollisionPolygon2D" parent="Inventory/Area2D"]

build_mode = 0
polygon = Vector2Array( -148.415, 89.3233, 16.166, 89.3233, 18.9556, 309.695, 66.3772, 379.432, 18.9556, 463.118, 21.745, 703.015, -159.573, 700.226 )
shape_range = Vector2( 0, 2 )
trigger = false

[node name="Sprite" type="Sprite" parent="Inventory"]

texture = ExtResource( 1 )

[node name="Area2D" type="Area2D" parent="Inventory/Sprite"]

input/pickable = true
shapes/0/shape = SubResource( 6 )
shapes/0/transform = Matrix32( 1, 0, 0, 1, 0, 0 )
shapes/0/trigger = false
gravity_vec = Vector2( 0, 1 )
gravity = 98.0
linear_damp = 0.1
angular_damp = 1.0

[node name="CollisionPolygon2D" type="CollisionPolygon2D" parent="Inventory/Sprite/Area2D"]

build_mode = 0
polygon = Vector2Array( -7.42282, -71.6443, 34.6825, -14.0266, -12.963, 51.3474, -24.0433, 52.4554, -24.0433, -73.8604 )
shape_range = Vector2( 0, 0 )
trigger = false

[node name="AnimationPlayer" type="AnimationPlayer" parent="Inventory"]

playback/process_mode = 1
playback/default_blend_time = 0.0
root/root = NodePath("..")
anims/close = SubResource( 7 )
anims/open = SubResource( 8 )
playback/active = true
playback/speed = 1.0
blend_times = [  ]
autoplay = ""

[node name="Items" type="Node2D" parent="Inventory"]

[node name="feuille" parent="Inventory/Items" instance=ExtResource( 2 )]

visibility/visible = false
script/script = SubResource( 9 )

[node name="nuage" parent="Inventory/Items" instance=ExtResource( 2 )]

visibility/visible = false
texture = ExtResource( 3 )

[node name="ItemPlaces" type="Node2D" parent="Inventory"]

[node name="PinJoint2D" type="PinJoint2D" parent="Inventory/ItemPlaces"]

transform/pos = Vector2( -85, -220 )
node_a = NodePath("")
node_b = NodePath("")
bias/bias = 0.0
collision/exclude_nodes = true
softness = 0.0
script/script = SubResource( 10 )

[node name="PinJoint2D1" type="PinJoint2D" parent="Inventory/ItemPlaces"]

transform/pos = Vector2( -85, -110 )
node_a = NodePath("")
node_b = NodePath("")
bias/bias = 0.0
collision/exclude_nodes = true
softness = 0.0
script/script = SubResource( 10 )

[node name="PinJoint2D2" type="PinJoint2D" parent="Inventory/ItemPlaces"]

transform/pos = Vector2( -85, 0 )
node_a = NodePath("")
node_b = NodePath("")
bias/bias = 0.0
collision/exclude_nodes = true
softness = 0.0
script/script = SubResource( 10 )

[node name="PinJoint2D3" type="PinJoint2D" parent="Inventory/ItemPlaces"]

transform/pos = Vector2( -85, 110 )
node_a = NodePath("")
node_b = NodePath("")
bias/bias = 0.0
collision/exclude_nodes = true
softness = 0.0
script/script = SubResource( 10 )

[node name="PinJoint2D4" type="PinJoint2D" parent="Inventory/ItemPlaces"]

transform/pos = Vector2( -85, 220 )
node_a = NodePath("")
node_b = NodePath("")
bias/bias = 0.0
collision/exclude_nodes = true
softness = 0.0
script/script = SubResource( 10 )

[node name="Dialogue" type="Control" parent="."]

focus/ignore_mouse = false
focus/stop_mouse = true
size_flags/horizontal = 2
size_flags/vertical = 2
margin/left = 0.0
margin/top = 0.0
margin/right = 40.0
margin/bottom = 40.0
script/script = SubResource( 14 )

[node name="Area2DDialogue" type="Area2D" parent="Dialogue"]

editor/display_folded = true
transform/pos = Vector2( 0, 330 )
input/pickable = true
shapes/0/shape = SubResource( 13 )
shapes/0/transform = Matrix32( 1, 0, 0, 1, 0, 0 )
shapes/0/trigger = false
gravity_vec = Vector2( 0, 1 )
gravity = 98.0
linear_damp = 0.1
angular_damp = 1.0

[node name="CollisionPolygon2D" type="CollisionPolygon2D" parent="Dialogue/Area2DDialogue"]

build_mode = 0
polygon = Vector2Array( 349.401, 755.729, 352.826, 1084.51, 1602.87, 1087.93, 1609.72, 755.729 )
shape_range = Vector2( 0, 0 )
trigger = false

[node name="Sprite" type="Sprite" parent="Dialogue"]

transform/pos = Vector2( 975, 1230 )
transform/scale = Vector2( 0.902761, 0.902761 )
texture = ExtResource( 4 )

[node name="AnimationPlayer" type="AnimationPlayer" parent="Dialogue"]

playback/process_mode = 1
playback/default_blend_time = 0.0
root/root = NodePath("..")
anims/close = SubResource( 11 )
anims/open = SubResource( 12 )
playback/active = true
playback/speed = 1.0
blend_times = [  ]
autoplay = ""

[connection signal="mouse_enter" from="Inventory/Area2D" to="." method="_on_Area2D_mouse_enter"]

[connection signal="mouse_exit" from="Inventory/Area2D" to="." method="_on_Area2D_mouse_exit"]

[connection signal="input_event" from="Inventory/Sprite/Area2D" to="Inventory" method="_on_Area2D_input_event"]

[connection signal="mouse_enter" from="Dialogue/Area2DDialogue" to="." method="_on_Area2DDialogue_mouse_enter"]

[connection signal="mouse_exit" from="Dialogue/Area2DDialogue" to="." method="_on_Area2DDialogue_mouse_exit"]


